<!DOCTYPE HTML>
<html lang="zh">
    <head>
        <meta charset="UTF-8">
        <title>编译 kvm 时选择需要编译的音频驱动 | Jonathan's Blog</title>
        <script>if (top !== self) top.location = self.location;</script>
        <!--[if lt IE 9]>
        <script src="/static/html5.js?v=4443b"></script>
        <![endif]-->
        <meta name="HandheldFriendly" content="True" />
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0" />
        
<meta name="author" content="microjo" />

        
        <link rel="alternate" type="application/rss+xml" href="/feed.html" title="Jonathan's Blog Feed" />
        <link rel="stylesheet" href="/static/style.css?v=47c21" />
        
<link rel="canonical" href="/note/kvm_compile_audio.html" />
<link rel="stylesheet" href="/static/syntax.css?v=dbf77" />

        
     </head>
     <body>
         <header id="header">
             <nav class="fn-clear">
                 <ul id="nav" class="fn-right fn-clear">
                     <li id="nav-home"><a href="/">Home/首页</a></li>
                     <li id="nav-about"><a href="/about.html">About/关于</a></li>
                     <li id="nav-tags"><a href="/tag/">Tags/标签</a></li>
                 </ul>
             </nav>
         </header>
         
         <article class="hentry">
             <header class="entry-header fn-clear">
                 <h1 class="entry-title fn-left"><a href="/note/kvm_compile_audio.html">编译 kvm 时选择需要编译的音频驱动</a></h1>
                 
                 <form id="search-form" action="http://www.google.com/search">
                     <input type="hidden" name="q" value="site:http://microjo.github.com" />
                     <input id="search-input" class="ui-fm-text" type="text" placeholder="Search .." name="q" />
                 </form>
                 
             </header>
             
<div class="entry">
    <div class="entry-content">
        <p>使用 kvm 作为虚拟机安装 windows 系统，速度感觉很快，但是音频老是有问题：在进入虚拟机使用声卡后，外面的 ubuntu 不能够播放音乐。使用参数 <code>-audio-help</code> 查询支持的音频输出有哪些，发现有 alsa、oss、wav 等。依次 alsa、oss 作为输出使用都是类似的问题，差点就放弃使用声卡。由于 ubuntu 8.10 使用 PulseAudio 作为系统的声音服务，能够支持多个应用程序播放音频，就想 kvm 是否支持 PulseAudio 输出呢？Google 之后发现从 kvm 71 开始支持，参考官方 wiki 中的编译方法：</p>
<div class="code"><div class="highlight"><pre>tar xzf kvm-release.tar.gz
<span class="nb">cd </span>kvm-release
./configure --prefix<span class="o">=</span>/usr/local/kvm
make
sudo make install
sudo /sbin/modprobe kvm-intel
<span class="c"># or: sudo /sbin/modprobe kvm-amd</span>
</pre></div>
</div>

<p>编译安装之后，查询还是没有支持 PulseAudio 输出。于是，用 <code>./configure --help</code> 查询编译参数，里面没有提及声音驱动的设置。进一步查看 configure 的源代码，发现里面还设置了 qemu 目录下文件编译的参数，所以在 qemu 目录下面，执行 <code>./configure --help</code> 发现有了声音驱动的参数设置：</p>
<pre><code>--audio-drv-list=LIST set audio drivers list:
Available drivers: oss alsa sdl esd pa fmod
</code></pre>
<p>编译使用参数 <code>--audio-drv-list="alsa oss pa"</code>，其中 pa 表示 PulseAudio。编译安装后，配置参数 <code>export QEMU_AUDIO_DRV=pa</code> 使用 PulseAudio 输出成功解决问题，但是好像稳定性有问题，在虚拟机下面播放音频关闭后，会莫名奇妙的跳出。</p>
    </div>
    <div class="fn-clear">
        <p class="entry-rel fn-right">
        
        <a id="prev-entry" href="/note/execl_money_conversion.html" title="Excel 金额大小写转换公式" rel="prev">«Prev</a>
        
        
        <a id="next-entry" href="/work/ffsj.html" title="FFSJ: The Fastest File Splitter and Joiner v3.3 号称最快的文件分割、合并工具" rel="next">Next»</a>
        
        </p>
    </div>
</div>
<div class="entry-meta fn-clear">
    <p class="entry-time fn-left">
    Created at: 
    <a href="/2008/" rel="index"><time class="updated" datetime="2008-12-04T17:33:00Z" pubdate>Thu, Dec 04, 2008</time></a>
    </p>
    
    <p class="entry-tags fn-left">
    Tagged in:
    
    <a href="/tag/kvm/" class="tag" rel="tag">kvm</a>
    
    <a href="/tag/pulseaudio/" class="tag" rel="tag">PulseAudio</a>
    
    <a href="/tag/音频/" class="tag" rel="tag">音频</a>
    
    </p>
    
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'microjo';
    var disqus_title = '编译 kvm 时选择需要编译的音频驱动';
    (function() {
     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
     dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
</script>


         </article>
         
         <footer id="footer">
             <div class="copyright">© <a href="http://microjo.github.com">Jonathan's Blog</a> | Powered by <a href="http://lepture.com/project/liquidluck">Felix Felicis</a></div>
             <p class="love">Lovely designed by <a href="http://lepture.com">lepture</a> | Modified by MiCRoJo</p>
         </footer>
         <script type="text/javascript">
             var currentNav = window.currentNav || "nav-home";
             document.getElementById(currentNav).className = "current";
         </script>
     </body>
 </html>